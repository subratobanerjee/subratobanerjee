resources:
  jobs:
    gameshaper_playtest_stats:
      name: gameshaper_playtest_stats
      max_concurrent_runs: 1

      schedule:
        quartz_cron_expression: 0 0/10 * * * ?
        timezone_id: UTC
        pause_status: PAUSED

      webhook_notifications:
        on_failure:
          - id: ${var.slack_webhook}

      tasks:
        # - task_key: playtest_ingest
        #   job_cluster_key: playtest_stas_ingestion${var.environment}
        #   python_wheel_task:
        #     package_name: common
        #     entry_point: process_playtest
        #     parameters:
        #       - --environment
        #       - ${var.environment}
        #       - --endpoint
        #       - https://${var.api_environment}/rest/playtests/playtests?
 
        #   libraries:
        #     - whl: ${var.wheel_path}

        - task_key: playtest_stats_ingest
          job_cluster_key: playtest_stas_ingestion${var.environment}
          python_wheel_task:
            package_name: common
            entry_point: process_playtest_stats
            parameters:
              - --environment
              - ${var.environment}
              - --endpoint
              - https://${var.api_environment}/rest/playtests/playtests-stats
 
          libraries:
            - whl: ${var.wheel_path}
      
      job_clusters:
        - job_cluster_key: playtest_stas_ingestion${var.environment}
          new_cluster:
            spark_version: 15.2.x-scala2.12
            aws_attributes:
              availability: ON_DEMAND
            node_type_id: ${var.node_type_id}
            driver_node_type_id: ${var.driver_node_type_id}
            num_workers: ${var.num_workers}
            autotermination_minutes: 10
            init_scripts:
              - workspace:
                  destination: /Shared/datadog/dd_init.sh
            spark_env_vars:
              DD_API_KEY: "{{secrets/data-engineering/dd_api_key}}"
            custom_tags:
              owner: "Data Engineering"
      
      tags:
        business_unit: "Coretech DNA"
        catalog: "coretech${var.environment}"
        data_layer: "raw"
        environment: ${var.environment}
        owner: "Data Engineering"
      
      permissions:
        - level: CAN_MANAGE
          group_name: "dna live"
        - level: CAN_MANAGE
          group_name: "data engineering"