# The main job for storage cost.
resources:
  jobs:
    table_optimization:
      name: table_optimization
      max_concurrent_runs: 1
      
      webhook_notifications:
        on_failure:
          - id: ${var.slack_webhook}

      schedule:
        quartz_cron_expression: 0 30 * ? * * *
        timezone_id: UTC
        pause_status: ${var.schedule_status}

      # environments:
      #   - environment_key: utils_env
      #     spec:
      #       client: "1"
      #       dependencies:
      #         - /Workspace/Users/${workspace.current_user.userName}/${bundle.name}/${bundle.target}/artifacts/.internal/${var.wheel_name}-0.1-py3-none-any.whl

      tasks:
        - task_key: table_optimization
          notebook_task:
            notebook_path: ../src/table_optimization/table_optimization.py
            base_parameters:
              inputParam: '{"environment":"${var.environment}"}'
      
      tags:
        business_unit: "Data Engineering"
        environment: ${var.environment}
        owner: "Data Engineering"

      permissions:
        - level: CAN_MANAGE
          group_name: "dna live"
        - level: CAN_MANAGE
          group_name: "data engineering"
      
